!function(t,e){if("function"==typeof define&&define.amd)define("FldGrd",["module","exports"],e);else if("undefined"!=typeof exports)e(module,exports);else{var i={exports:{}};e(i,i.exports),t.FldGrd=i.exports}}(this,(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={rowHeight:300,rowHeightOrphan:function(t){return Math.round(t.heightAvg)},itemSelector:"*",objSelector:"img",dataWidth:"data-width",dataHeight:"data-height"};var s=function(t,e){if(!(t instanceof Element))throw new Error("`el` is not an element");return this.el=t,this.items=[],this._props={gutter:null,pendingResize:!1},this._bind={},this._settings=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];var n=Object(t);return Object.keys(i).forEach((function(t){void 0!==i[t]&&null!==i[t]&&Object.keys(i[t]).forEach((function(e){n[e]=i[t][e]}))})),n}({},i,e),this._init(),this};s.prototype={_init:function(){this._setup(),this._attachEventListeners(),this.update()},_setup:function(){var t,e,i=null,s=null,n=null,r=0;for(t=(i=function(t,e){var i,s=[],n=null,r=null;for(n=e.split(","),t.id||(r="_temp_"+Math.random().toString(36).substr(2,10),t.setAttribute("id",r));n.length;)s.push("#"+t.id+" > "+n.pop());return i=document.querySelectorAll(s.join(", ")),r&&t.removeAttribute("id"),i}(this.el,this._settings.itemSelector)).length,e=getComputedStyle(i[0],null),this._props.gutter+=parseInt(e.marginLeft,10)||0,this._props.gutter+=parseInt(e.marginRight,10)||0,this._props.gutter+=parseInt(e.paddingLeft,10)||0,this._props.gutter+=parseInt(e.paddingRight,10)||0;r<t;r++)s=parseInt(i[r].getAttribute(this._settings.dataWidth),10),n=parseInt(i[r].getAttribute(this._settings.dataHeight),10),isNaN(s)||isNaN(n)||this.items.push({width:s,normWidth:s*(this._settings.rowHeight/n),height:n,el:i[r].querySelector(this._settings.objSelector)})},update:function(){for(var t=this.el.clientWidth,e=this.items.length,i=[],s=0,n=0,r=0,h=0,o=0,d=0,a=0,l=0,u=!1,p=0,g=0;p<e;p++)if(u=p===e-1,(n+=this.items[p].normWidth)+(h+=this._props.gutter)>=t||u){for((r=t-h)/n>1&&u?a=(o=this._settings.rowHeightOrphan.call(this,{heightAvg:d/i.length,heights:i}))/this._settings.rowHeight:(a=Math.min(r/n,1),o=Math.floor(a*this._settings.rowHeight)),i.push(o),d+=o,g=s;g<=p;g++)l=Math.floor(a*this.items[g].normWidth)-1,this.items[g].el.style.width=l+"px",this.items[g].el.style.height=o+"px";n=0,h=0,s=p+1}return this._props.pendingResize=!1,this},_attachEventListeners:function(){this._bind.resize=this._handleResize.bind(this),window.addEventListener("resize",this._bind.resize)},_handleResize:function(){this._props.pendingResize||(this._props.pendingResize=!0,window.requestAnimationFrame(this.update.bind(this)))},destroy:function(){window.removeEventListener("resize",this._bind.resize),this.el=this.items=this._bind=this._settings=this._handlers=null}},e.default=s,t.exports=e.default}));